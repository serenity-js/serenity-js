"use strict";(self.webpackChunk_documentation_serenity_js_org=self.webpackChunk_documentation_serenity_js_org||[]).push([[3959],{82247:(e,t,a)=>{a.d(t,{xA:()=>u,yg:()=>g});var n=a(14041);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),l=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=l(a),c=r,g=m["".concat(p,".").concat(c)]||m[c]||d[c]||s;return a?n.createElement(g,i(i({ref:t},u),{},{components:a})):n.createElement(g,i({ref:t},u))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,i=new Array(s);i[0]=c;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[m]="string"==typeof e?e:r,i[1]=o;for(var l=2;l<s;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},2813:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var n=a(89575),r=(a(14041),a(82247));const s={sidebar_position:3,title:"Sending requests"},i="Sending requests",o={unversionedId:"api-testing/sending-requests",id:"api-testing/sending-requests",title:"Sending requests",description:"To make a Serenity/JS actor send an HTTP request, you need to configure it with the ability to CallAnApi",source:"@site/docs/api-testing/sending-requests.mdx",sourceDirName:"api-testing",slug:"/api-testing/sending-requests",permalink:"/handbook/api-testing/sending-requests",draft:!1,editUrl:"https://github.com/serenity-js/serenity-js/tree/main/documentation/serenity-js.org/docs/api-testing/sending-requests.mdx",tags:[],version:"current",lastUpdatedBy:"Jan Molak",lastUpdatedAt:1710354606,formattedLastUpdatedAt:"Mar 13, 2024",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Sending requests"},sidebar:"docs",previous:{title:"Configuring the HTTP client",permalink:"/handbook/api-testing/configuring-http-client"},next:{title:"Verifying responses",permalink:"/handbook/api-testing/verifying-responses"}},p={},l=[{value:"Using relative resource URLs",id:"using-relative-resource-urls",level:2},{value:"Using absolute resource URLs",id:"using-absolute-resource-urls",level:2},{value:"Sending data",id:"sending-data",level:2},{value:"Sending dynamic JSON data",id:"sending-dynamic-json-data",level:3},{value:"Sending form data",id:"sending-form-data",level:3},{value:"Sending dynamic form data",id:"sending-dynamic-form-data",level:3}],u={toc:l},m="wrapper";function d(e){let{components:t,...a}=e;return(0,r.yg)(m,(0,n.A)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"sending-requests"},"Sending requests"),(0,r.yg)("p",null,"To make a Serenity/JS actor send an HTTP request, you need to ",(0,r.yg)("a",{parentName:"p",href:"/handbook/api-testing/configuring-http-client/"},"configure it with the ability to ",(0,r.yg)("inlineCode",{parentName:"a"},"CallAnApi")),"\nand instruct to perform an interaction to ",(0,r.yg)("a",{parentName:"p",href:"/api/rest/class/Send/"},(0,r.yg)("inlineCode",{parentName:"a"},"Send"))," one of the available ",(0,r.yg)("a",{parentName:"p",href:"/api/rest/class/HeadRequest/"},(0,r.yg)("inlineCode",{parentName:"a"},"HTTPRequest")),"\nimplementations:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/api/rest/class/GetRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"GetRequest"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/api/rest/class/PostRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"PostRequest"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/api/rest/class/DeleteRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"DeleteRequest"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/api/rest/class/HeadRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"HeadRequest"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/api/rest/class/PatchRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"PatchRequest"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/api/rest/class/PutRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"PutRequest"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/api/rest/class/OptionsRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"OptionsRequest")))),(0,r.yg)("p",null,"Code listings below present some of the common usage patterns, but make sure to check the ",(0,r.yg)("a",{parentName:"p",href:"/api/rest"},"Serenity/JS REST API documentation")," for more examples."),(0,r.yg)("h2",{id:"using-relative-resource-urls"},"Using relative resource URLs"),(0,r.yg)("p",null,"When a ",(0,r.yg)("inlineCode",{parentName:"p"},"HTTPRequest")," is configured with a relative URL, such URL gets resolved against the base URL configured in the ability to ",(0,r.yg)("a",{parentName:"p",href:"/api/rest/class/CallAnApi/"},(0,r.yg)("inlineCode",{parentName:"a"},"CallAnApi")),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"import { actorCalled } from '@serenity-js/core'\nimport { CallAnApi, GetRequest, LastResponse, Send } from '@serenity-js/rest'\nimport { Ensure, equals } from '@serenity-js/assertions'\n\nawait actorCalled('Apisitt')\n    .whoCan(CallAnApi.at('https://api.example.org/v1/'))\n    .attemptsTo(\n        Send.a(GetRequest.to('users')),                        // GET https://api.example.org/v1/users\n        Ensure.that(LastResponse.status(), equals(200)),\n    )\n")),(0,r.yg)("h2",{id:"using-absolute-resource-urls"},"Using absolute resource URLs"),(0,r.yg)("p",null,"When a ",(0,r.yg)("inlineCode",{parentName:"p"},"HTTPRequest")," is configured with absolute URL, base URL configured in the ability to ",(0,r.yg)("a",{parentName:"p",href:"/api/rest/class/CallAnApi/"},(0,r.yg)("inlineCode",{parentName:"a"},"CallAnApi"))," is ignored for this request."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"import { actorCalled } from '@serenity-js/core'\nimport { CallAnApi, GetRequest, LastResponse, Send } from '@serenity-js/rest'\nimport { Ensure, equals } from '@serenity-js/assertions'\n\nawait actorCalled('Apisitt')\n    .whoCan(CallAnApi.at('https://api.example.org/v1/'))\n    .attemptsTo(\n        Send.a(GetRequest.to('https://auth.example.org/token')), // GET https://auth.example.org/token\n        Ensure.that(LastResponse.status(), equals(200)),\n    )\n")),(0,r.yg)("h2",{id:"sending-data"},"Sending data"),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"/api/rest/class/PostRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"PostRequest")),", ",(0,r.yg)("a",{parentName:"p",href:"/api/rest/class/PatchRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"PatchRequest"))," and ",(0,r.yg)("a",{parentName:"p",href:"/api/rest/class/PutRequest"},(0,r.yg)("inlineCode",{parentName:"a"},"PutRequest"))," can be configured using the ",(0,r.yg)("inlineCode",{parentName:"p"},".with(data)")," method to send data in the request body.\nSuch data can be any ",(0,r.yg)("a",{parentName:"p",href:"/api/core/#Answerable"},(0,r.yg)("inlineCode",{parentName:"a"},"Answerable"))," that resolves to a JSON object, a ",(0,r.yg)("inlineCode",{parentName:"p"},"string"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"ArrayBuffer"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"ArrayBufferView"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"Buffer"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"Stream"),", or ",(0,r.yg)("inlineCode",{parentName:"p"},"URLSearchParams"),".\nSee ",(0,r.yg)("a",{parentName:"p",href:"https://axios-http.com/docs/req_config"},"Axios API documentation")," for more details on supported data types."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"import { actorCalled } from '@serenity-js/core'\nimport { LastResponse, PostRequest, Send } from '@serenity-js/rest'\nimport { Ensure, equals } from '@serenity-js/assertions'\n\nawait actorCalled('Apisitt')\n  .attemptsTo(\n    Send.a(PostRequest.to('/books').with({\n      isbn: '0-688-00230-7',\n      title: 'Zen and the Art of Motorcycle Maintenance: An Inquiry into Values',\n      author: 'Robert M. Pirsig',\n    })),\n    Ensure.that(LastResponse.status(), equals(201)),\n  )\n")),(0,r.yg)("h3",{id:"sending-dynamic-json-data"},"Sending dynamic JSON data"),(0,r.yg)("p",null,"If you need to send data that's determined dynamically as part of the test scenario, use ",(0,r.yg)("a",{parentName:"p",href:"/api/core/class/Question/#fromObject"},(0,r.yg)("inlineCode",{parentName:"a"},"Question.fromObject")),"\nto create a ",(0,r.yg)("a",{parentName:"p",href:"/api/core/class/Question/"},(0,r.yg)("inlineCode",{parentName:"a"},"Question"))," that resolves to a JSON object."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"import { actorCalled, Question } from '@serenity-js/core'\nimport { LastResponse, PostRequest, Send } from '@serenity-js/rest'\nimport { Ensure, equals } from '@serenity-js/assertions'\nimport { By, Text, PageElement } from '@serenity-js/web'\n\nawait actorCalled('Apisitt')\n  .attemptsTo(\n    Send.a(PostRequest.to('/register').with(\n        Question.fromObject({                                       // Generate a Question<JSONObject>\n          token: Text.of(PageElement.located(By.id('#api-token'))), // with text of an HTML element\n        })\n    ),\n    Ensure.that(LastResponse.status(), equals(201)),\n  )\n")),(0,r.yg)("h3",{id:"sending-form-data"},"Sending form data"),(0,r.yg)("p",null,"To post ",(0,r.yg)("inlineCode",{parentName:"p"},"multipart/form-data"),", use ",(0,r.yg)("a",{parentName:"p",href:"https://axios-http.com/docs/multipart"},(0,r.yg)("inlineCode",{parentName:"a"},"axios.toFormData"))," helper."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"import { actorCalled } from '@serenity-js/core'\nimport { LastResponse, PostRequest, Send } from '@serenity-js/rest'\nimport { Ensure, equals } from '@serenity-js/assertions'\n\nimport axios from 'axios'\n\nconst form = axios.toFormData({\n    grant_type: 'password',\n    username:   'alice.smith',\n    password:   'secret',\n})\n\nawait actorCalled('Apisitt')\n  .attemptsTo(\n    Send.a(PostRequest.to('/oauth/token').with(form)),\n    Ensure.that(LastResponse.status(), equals(200)),\n  )\n")),(0,r.yg)("h3",{id:"sending-dynamic-form-data"},"Sending dynamic form data"),(0,r.yg)("p",null,"To post ",(0,r.yg)("inlineCode",{parentName:"p"},"multipart/form-data")," where form data is determined dynamically as part of the test scenario,\ncombine ",(0,r.yg)("a",{parentName:"p",href:"/api/core/class/Question/#fromObject"},(0,r.yg)("inlineCode",{parentName:"a"},"Question.fromObject")),", ",(0,r.yg)("a",{parentName:"p",href:"http://localhost:3000/api/core/class/Question/#as"},(0,r.yg)("inlineCode",{parentName:"a"},"Question.as")),",\nand the ",(0,r.yg)("a",{parentName:"p",href:"https://axios-http.com/docs/multipart"},(0,r.yg)("inlineCode",{parentName:"a"},"axios.toFormData"))," helper."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"import { actorCalled, Question } from '@serenity-js/core'\nimport { LastResponse, PostRequest, Send } from '@serenity-js/rest'\nimport { Ensure, equals } from '@serenity-js/assertions'\nimport { By, Text, PageElement } from '@serenity-js/web'\n\nimport axios from 'axios'\n\nconst form = Question\n    .fromObject({\n        grant_type: 'password',                                     // Some data can be static\n        username:   'alice.smith',\n        password:   Text.of(PageElement.located(By.id('#totp'))),   // while some can be dynamic\n    })\n    .as(data => axios.toFormData(data))\n\nawait actorCalled('Apisitt')\n  .attemptsTo(\n    Send.a(PostRequest.to('/oauth/token').with(form)),\n    Ensure.that(LastResponse.status(), equals(200)),\n  )\n")))}d.isMDXComponent=!0}}]);