<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-85788349-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-85788349-2');
    </script>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base href="/">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,900,700,400italic" rel="stylesheet">
    <title>The trouble with test scripts | Serenity/JS</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="manifest" href="/icons/site.webmanifest">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="/css/charming-pro-serenity-js.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css"
          integrity="sha256-zmfNZmXoNWBMemUOo1XUGFfc0ihGGLYdgtJS3KCr/l0=" crossorigin="anonymous" />
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css"
          integrity="sha256-AJfZWudfDWpFpIZ3USExGYDGwsYz47IgfEQCiGTm4wQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" integrity="sha256-3YM6A3pH4QFCl9WbSU8oXF5N6W/2ylvW0o2g+Z6TmLQ=" crossorigin="anonymous" />
</head>
<body>

<div id="top"
        class="block block-dark block-bb bg-gradient-accent-2 p-0 d-print-none">
    <div class="container">
        <nav id="web-nav" class="web-nav web-nav-light">
            <header>
                <a href="/" class="serenity-js-logo">
                    <svg width="190px" height="42px" viewBox="0 0 1077 243" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
                        <path class="logo-accent" d="M295.133,157.626l22.342,0c1.571,12.567 6.633,23.04 27.753,23.04c13.789,0 23.563,-7.68 23.563,-19.2c0,-11.52 -5.76,-15.884 -26.007,-19.2c-29.847,-4.015 -43.985,-13.091 -43.985,-36.48c0,-20.422 17.454,-35.782 43.461,-35.782c26.881,0 42.938,12.219 45.382,36.131l-21.294,0c-2.27,-13.091 -9.775,-18.676 -24.088,-18.676c-14.138,0 -21.469,6.807 -21.469,16.407c0,10.123 4.19,15.186 25.833,18.327c29.323,4.015 44.509,12.393 44.509,37.353c0,21.643 -18.327,38.574 -45.905,38.574c-34.036,0 -48.35,-16.931 -50.095,-40.494" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M472.468,141.219c-1.048,-15.709 -9.077,-22.691 -22.168,-22.691c-12.741,0 -21.294,8.552 -23.389,22.691l45.557,0Zm-67.55,10.473l0,-1.397c0,-28.276 19.375,-47.127 45.382,-47.127c22.691,0 43.113,13.44 43.113,46.08l0,6.109l-66.851,0c0.698,17.28 9.426,27.054 25.135,27.054c12.742,0 19.375,-5.061 20.945,-13.963l20.422,0c-2.967,19.2 -18.502,29.672 -41.891,29.672c-26.88,0 -46.255,-17.629 -46.255,-46.428" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M513.481,105.088l14.487,0l0,16.407c5.761,-10.298 13.616,-17.454 30.023,-17.978l0,13.615c-18.327,0.872 -30.023,6.633 -30.023,29.148l0,50.095l-14.487,0l0,-91.287Z" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M637.754,141.917c-1.396,-18.851 -11.171,-26.356 -26.182,-26.356c-14.836,0 -24.785,10.124 -27.229,26.356l53.411,0Zm-68.945,9.774l0,-1.396c0,-27.578 17.629,-46.778 42.763,-46.778c21.12,0 41.019,12.742 41.019,45.381l0,4.713l-68.772,0c0.699,20.771 10.648,32.291 29.325,32.291c14.137,0 22.341,-5.236 24.261,-15.883l14.488,0c-3.143,18.327 -18.328,27.927 -38.924,27.927c-25.833,0 -44.16,-18.153 -44.16,-46.255" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M673.882,105.088l14.487,0l0,14.487c4.189,-8.552 14.313,-16.058 29.324,-16.058c18.85,0 32.116,10.299 32.116,36.829l0,56.029l-14.488,0l0,-57.076c0,-16.059 -6.806,-23.215 -21.468,-23.215c-13.441,0 -25.484,8.553 -25.484,24.96l0,55.331l-14.487,0l0,-91.287Z" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M772.733,105.088l14.486,0l0,91.287l-14.487,0l0,-91.287Zm-2.618,-28.626c0,-5.237 4.365,-9.6 9.601,-9.6c5.236,0 9.599,4.363 9.599,9.6c0,5.237 -4.363,9.6 -9.599,9.6c-5.236,0 -9.601,-4.363 -9.601,-9.6" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M819.16,173.51l0,-56.204l-13.091,0l0,-12.218l13.091,0l0,-20.77l14.487,0l0,20.77l21.294,0l0,12.218l-21.294,0l0,54.808c0,8.901 4.015,13.265 11.346,13.265c4.538,0 8.028,-0.698 11.171,-1.92l0,12.218c-2.968,1.047 -6.459,1.92 -12.394,1.92c-16.581,0 -24.61,-9.774 -24.61,-24.087" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M902.589,186.949l-35.782,-81.861l15.535,0l27.927,65.454l25.309,-65.454l14.836,0l-50.443,123.054l-14.662,0l17.28,-41.193Z" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M996.26,100.15l7.752,0l-22.728,69.537l-7.675,0l22.651,-69.537Z" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M1002.35,157.646l0,-7.826c1.882,0.752 3.763,1.353 6.924,1.353c4.891,0 8.053,-2.558 8.053,-9.181l0,-37.252l10.084,0l0,37.478c0,11.664 -6.698,17.008 -16.632,17.008c-4.44,0 -6.698,-0.678 -8.429,-1.58" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M1035.46,141.841l9.633,0c0.678,5.42 2.86,9.934 11.966,9.934c5.945,0 10.16,-3.311 10.16,-8.278c0,-4.967 -2.484,-6.847 -11.214,-8.277c-12.868,-1.733 -18.964,-5.645 -18.964,-15.729c0,-8.806 7.525,-15.427 18.738,-15.427c11.59,0 18.514,5.267 19.567,15.578l-9.181,0c-0.978,-5.645 -4.215,-8.053 -10.386,-8.053c-6.095,0 -9.256,2.934 -9.256,7.074c0,4.366 1.806,6.547 11.138,7.901c12.643,1.732 19.191,5.343 19.191,16.105c0,9.332 -7.903,16.633 -19.793,16.633c-14.675,0 -20.846,-7.301 -21.599,-17.461" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M152.636,121.232c0,17.344 -14.06,31.404 -31.404,31.404c-17.344,0 -31.405,-14.06 -31.405,-31.404c0,-17.344 14.061,-31.404 31.405,-31.404c17.344,0 31.404,14.06 31.404,31.404" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M230.534,68.726l-67.217,67.217l46.941,0c-7.045,42.781 -44.281,75.521 -89.026,75.521c-31.396,0 -59.086,-16.127 -75.255,-40.523l-22.286,22.287c22.081,29.866 57.547,49.236 97.541,49.236c66.955,0 121.232,-54.277 121.232,-121.232c0,-18.81 -4.284,-36.619 -11.93,-52.506m-198.328,37.796c7.045,-42.782 44.281,-75.522 89.026,-75.522c31.396,0 59.086,16.127 75.255,40.523l22.286,-22.286c-22.081,-29.867 -57.547,-49.237 -97.541,-49.237c-66.955,0 -121.232,54.278 -121.232,121.232c0,18.811 4.284,36.62 11.93,52.506l67.217,-67.216l-46.941,0Z" style="fill-rule:nonzero;"/>
                    </svg>
                </a>
        
                <a href="#!" class="web-nav-toggler">
                    <span class="fa fa-close"></span>
                    <span class="fa fa-bars"></span>
                </a>
            </header>
        
            <div class="web-nav-list">
                <a href="/handbook" class="web-nav-item">Handbook</a>
                <a href="/modules" class="web-nav-item">Modules</a>
                <a href="/changelog.html" class="web-nav-item">Changelog</a>
                <a href="/support.html" class="web-nav-item">Support</a>
                <a href="/community/sponsors.html" class="web-nav-item">Sponsors</a>
                <a href="https://github.com/serenity-js" class="web-nav-item">
                    <span class="d-block d-lg-none">Source code</span><span class="fab fa-github d-none d-lg-inline"> </span>
                </a>
            </div>
        
            <div id="web-nav-mobile-indicator"><!-- this signals to the javascript if the navigation is mobile or not --></div>
        </nav>
    </div>
</div>

<section id="handbook">
    <section>
        <div class="container">
            <div class="row">
                <aside id="sidebar" class="col-lg-3 col-md-12 d-print-none">
                    <nav class="toc navigation text-truncate" data-ice="nav">
                        <ul class="summary">
                                <li class="header"><a href="/handbook/index.html">Overview</a></li>
                                <li class="chapter"><a href="/handbook/why-serenityjs.html">Why Serenity/JS?</a></li>
                                <li class="chapter"><a href="/handbook/demo.html">Demo</a></li>
                                <li class="chapter"><a href="/handbook/about.html">About this book</a></li>
                                <li class="chapter"><a href="/support.html">Support</a></li>
                                <li class="chapter"><a href="/contributing.html">Contributing</a></li>
                                <li class="chapter"><a href="/license.html">License</a></li>
                                <li class="header"><a href="/handbook/thinking-in-serenity-js/index.html">Thinking in Serenity/JS</a></li>
                                <li class="chapter"><a href="/handbook/thinking-in-serenity-js/the-trouble-with-test-scripts.html">The trouble with test scripts</a></li>
                                <li class="chapter"><a href="/handbook/thinking-in-serenity-js/screenplay-pattern.html">The Screenplay Pattern</a></li>
                                <li class="chapter"><a href="/handbook/thinking-in-serenity-js/lean-page-objects.html">Lean Page Objects</a></li>
                                <li class="chapter"><a href="/handbook/thinking-in-serenity-js/full-stack-acceptance-testing.html">Full-stack acceptance testing</a></li>
                                <li class="chapter"><a href="/handbook/thinking-in-serenity-js/bridging-the-communication-gap.html">Bridging the communication gap</a></li>
                                <li class="header"><a href="/handbook/design/index.html">Design Guide</a></li>
                                <li class="chapter"><a href="/handbook/design/actors.html">Actors</a></li>
                                <li class="chapter"><a href="/handbook/design/abilities.html">Abilities</a></li>
                                <li class="chapter"><a href="/handbook/design/interactions.html">Interactions</a></li>
                                <li class="chapter"><a href="/handbook/design/tasks.html">Tasks</a></li>
                                <li class="chapter"><a href="/handbook/design/questions.html">Questions</a></li>
                                <li class="chapter"><a href="/handbook/design/assertions.html">Assertions</a></li>
                                <li class="chapter"><a href="/handbook/design/errors.html">Errors</a></li>
                                <li class="header"><a href="/handbook/integration/index.html">Integration Guide</a></li>
                                <li class="chapter"><a href="/handbook/integration/architecture.html">Architecture</a></li>
                                <li class="chapter"><a href="/handbook/integration/runtime-dependencies.html">Runtime dependencies</a></li>
                                <li class="chapter"><a href="/handbook/integration/versioning.html">Versioning</a></li>
                                <li class="chapter"><a href="/handbook/integration/installation.html">Installation</a></li>
                                <li class="chapter"><a href="/handbook/integration/serenityjs-and-cucumber.html">Serenity/JS and Cucumber</a></li>
                                <li class="chapter"><a href="/handbook/integration/serenityjs-and-jasmine.html">Serenity/JS and Jasmine</a></li>
                                <li class="chapter"><a href="/handbook/integration/serenityjs-and-protractor.html">Serenity/JS and Protractor</a></li>
                                <li class="chapter"><a href="/handbook/integration/reporting.html">Reporting</a></li>
                                <li class="header"><a href="/community/index.html">Community</a></li>
                                <li class="chapter"><a href="/community/events-and-articles.html">Events and articles</a></li>
                                <li class="chapter"><a href="/community/sponsors.html">Serenity/JS Sponsors</a></li>
                        </ul>
                    </nav>
                </aside>

                <div class="col-lg-9 col-md-12">
                    <article class="content">
                        <nav class="article-tools">
                            <a href="https://github.com/serenity-js/serenity-js/edit/master/documentation/website/src/handbook/thinking-in-serenity-js/the-trouble-with-test-scripts.md">
                                <i class="far fa-edit"></i> Edit on Github</a>
                        </nav>
                        <section class="github-markdown">
                            <html><head></head><body><h1 id="the-trouble-with-test-scripts">The trouble with test scripts</h1>
<p>Imagine for a moment that we wanted to write some automated acceptance tests
for the <a href="http://todomvc.com/examples/angularjs/#/">TodoMVC app</a> -&#xA0;a&#xA0;simple web application
that allows its users to manage a to-do list.</p>
<p>To make things a bit more interesting, let&apos;s say that the <a href="https://en.wikipedia.org/wiki/User_story">user story</a>
we want to write an acceptance test for looks as follows:</p>
<pre><code class="lang-plaintext hljs plaintext">In order to focus on my outstanding tasks
As a forgetful person
I want to be able to filter my todos to see active items only
</code></pre>
<p><img src="/handbook/thinking-in-serenity-js/images/todomvc.gif" alt="TodoMVC Angular.js app by Christoph Burgdorf, Eric Bidelman, Jacob Mumm and Igor Minar" style="display: block; margin:0 auto; width:640px;"></p>
<p>You can probably already guess that to verify this scenario, a tester would need to:</p>
<ul>
<li>start with a to-do list containing several items,</li>
<li>mark one of them as complete,</li>
<li>filter the list to show active items only,</li>
<li>ensure that the only items they see are the ones that are still outstanding.</li>
</ul>
<p>Let&apos;s now look at two ways of approaching the task of automating a test scenario that does precisely that.</p>
<h2 id="a-test-script">A test script</h2>
<p>The most common implementation follows what I like to call <em>the scripting approach</em>.</p>
<p>A test implemented in this style is characterised by numerous calls to low-level WebDriver or WebDriver-like APIs
and exhibit few or no business-focused abstractions.</p>
<p>Below is an example test following the scripting approach, implemented using raw <a href="https://www.protractortest.org/#">Protractor</a> and <a href="https://jasmine.github.io/">Jasmine</a>.
Please note, however, that this style is by no means specific to those particular tools as you&apos;ll see it often being used with other similar libraries and frameworks:</p>
<pre><code class="lang-javascript hljs javascript">describe(<span class="hljs-string">&apos;Todo List App&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    it(<span class="hljs-string">&apos;allows the user to show active items only&apos;</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// low-level navigation and synchronisation code</span>
        <span class="hljs-keyword">await</span> protractor.browser.get(<span class="hljs-string">&apos;http://todomvc.com/examples/angularjs/#/&apos;</span>);
        <span class="hljs-keyword">await</span> protractor.browser.wait(
                protractor.ExpectedConditions.presenceOf(element(by.css(<span class="hljs-string">&apos;.new-todo&apos;</span>))),
                <span class="hljs-number">2000</span>,
            );
        expect(<span class="hljs-keyword">await</span> protractor.browser.getTitle()).toMatch(<span class="hljs-regexp">/.*TodoMVC$/</span>);

        <span class="hljs-comment">// duplicated code</span>
        <span class="hljs-keyword">await</span> element(by.css(<span class="hljs-string">&apos;.new-todo&apos;</span>)).sendKeys(<span class="hljs-string">&apos;Play some guitar&apos;</span>);
        <span class="hljs-keyword">await</span> element(by.css(<span class="hljs-string">&apos;.new-todo&apos;</span>)).sendKeys(protractor.Key.ENTER);

        <span class="hljs-keyword">await</span> element(by.css(<span class="hljs-string">&apos;.new-todo&apos;</span>)).sendKeys(<span class="hljs-string">&apos;Read a book&apos;</span>);
        <span class="hljs-keyword">await</span> element(by.css(<span class="hljs-string">&apos;.new-todo&apos;</span>)).sendKeys(protractor.Key.ENTER);

        <span class="hljs-keyword">await</span> element(by.css(<span class="hljs-string">&apos;.new-todo&apos;</span>)).sendKeys(<span class="hljs-string">&apos;Write some code&apos;</span>);
        <span class="hljs-keyword">await</span> element(by.css(<span class="hljs-string">&apos;.new-todo&apos;</span>)).sendKeys(protractor.Key.ENTER);

        <span class="hljs-comment">// complex XPath locators</span>
        <span class="hljs-keyword">await</span> element(by.xpath(
                <span class="hljs-string">`//li[*[@class=&apos;view&apos; and contains(.,&apos;Write some code&apos;)]]//input[contains(@class,&apos;toggle&apos;)]`</span>)
            ).click();

        <span class="hljs-keyword">await</span> element(by.linkText(<span class="hljs-string">`Active`</span>))
            .click();

        <span class="hljs-comment">// a mix of async/await style and Promises</span>
        <span class="hljs-keyword">await</span> element.all(by.css(<span class="hljs-string">&apos;.todo-list li&apos;</span>)).getText()
            .then(<span class="hljs-function"><span class="hljs-params">items</span> =&gt;</span> {
                expect(items).toEqual([
                    <span class="hljs-string">&apos;Play some guitar&apos;</span>,
                    <span class="hljs-string">&apos;Read a book&apos;</span>,
                ]);
            });
    });

    afterEach(<span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-comment">// clean up code required to avoid state leakage</span>
        <span class="hljs-keyword">await</span> browser.executeScript(<span class="hljs-string">`window.localStorage.clear()`</span>);
    });
});
</code></pre>
<p>The code above &quot;gets the job done&quot; and automates the scenario we talked about.</p>
<p>However, this implementation is far from ideal for a  number of reasons, some of which I&apos;ve highlighted in the comments in the code sample above:</p>
<ul>
<li>There&apos;s a lot of duplication.</li>
<li>The setup and cleanup code is at the same level of abstraction and importance as the main scenario flow, cluttering the test.</li>
<li>Complex <a href="https://en.wikipedia.org/wiki/XPath">XPath</a> locators couple the test tightly to the UI and make it susceptible to any changes in its structure.</li>
<li>Even small changes to the application structure or the user workflow tend to have <a href="https://sourcemaking.com/refactoring/smells/shotgun-surgery">a big impact</a> on the test code, making it difficult for the tests to keep pace with the application.</li>
<li>The low-level, detail-focused code makes it hard to see at a glance if the test is actually doing its job correctly. It also makes it impossible for a non-technical business person to read and verify its logic.</li>
<li>When a test suite like this expands, developers need to spend more and more time tackling the widespread duplication and keeping the test suite up to date with the application. This makes it increasingly hard to add new tests for any new functionality.</li>
<li>Not to mention that tests like the one above make it virtually impossible to <a href="https://en.wikipedia.org/wiki/Acceptance_test%E2%80%93driven_development">test-drive the development</a> of a software system as they&apos;re too tightly coupled to the implementation.</li>
</ul>
<p>As you can probably already tell, I&apos;m not a fan of this approach as it tends to be <strong>a recipe for a maintenance disaster</strong>.</p>
<p>The creator of Selenium WebDriver, <a href="https://blog.rocketpoweredjetpants.com/">Simon Stewart</a>, holds the same view:</p>
<blockquote>
<p>If you have WebDriver APIs in your test methods, You&apos;re Doing It Wrong.</p>
<p>Simon Stewart</p>
</blockquote>
<p>So let&apos;s see what we can do about this sorry state of affairs and find a way to improve our test and encapsulate and reuse some of the common parts.</p>
<h2 id="the-page-object-s-pattern">The Page Object(s) Pattern</h2>
<p>As Selenium WebDriver became more popular in the late 2000s, and test suites began to grow bigger,
developers and testers new to browser-based test automation needed a way to address issues with test scripts.</p>
<p>In response to this need, the <a href="https://docs.seleniumhq.org/">Selenium team</a> proposed the <a href="https://selenium.dev/documentation/en/guidelines_and_recommendations/page_object_models/">Page Object Pattern</a>.
This simple pattern focuses on the user interface and models it in terms of pages, with each page being represented by a distinct class encapsulating both the definition of the page structure and the tasks that a user can perform on that page.</p>
<p>The original Page Object Pattern was later <a href="https://martinfowler.com/bliki/PageObject.html">refined by Martin Fowler</a>, who proposed that instead of thinking of the entire application as a set of pages, each page should be considered in terms of smaller page objects or &quot;widgets&quot; that the page contained. The implementation below uses that refined version, as it&apos;s more representative of what you&apos;d find in the more modern codebases.</p>
<p>What you&apos;ll see in the code sample below is a by-the-book implementation of the Page Objects pattern.
For simplicity, I&apos;ve implemented the page object representing the <code>TodoList</code> in the same file as the test using it, as well as the test-specific <a href="https://jasmine.github.io/api/3.5/global.html#afterEach">teardown method</a>
that prevents the application state from leaking between the tests. I&apos;ve also annotated the code to highlight the features and limitations of this implementation:</p>
<pre><code class="lang-javascript hljs javascript">describe(<span class="hljs-string">&apos;Todo List App&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-comment">// The page object representing the Todo list:</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TodoList</span> </span>{

        <span class="hljs-keyword">constructor</span>() {
            <span class="hljs-comment">// Interactive elements represented as &quot;private&quot; fields of the page object</span>
            <span class="hljs-comment">// to encourage the developers to use the &quot;public&quot; methods instead</span>
            <span class="hljs-keyword">this</span>._whatNeedsToBeDoneInputBox = element(by.css(<span class="hljs-string">&apos;.new-todo&apos;</span>));
            <span class="hljs-keyword">this</span>._recordedItems             = element.all(by.css(<span class="hljs-string">&apos;.todo-list li&apos;</span>));
        }

        <span class="hljs-comment">// The methods of the page object represent the tasks that the user</span>
        <span class="hljs-comment">// can perform on a given page or using a given UI widget, such as:</span>
        <span class="hljs-comment">// - recordItemCalled(itemName)</span>
        <span class="hljs-comment">// - completeItemCalled(itemName)</span>
        <span class="hljs-comment">// - filterToShowActiveItemsOnly(), etc.</span>

        <span class="hljs-comment">// Each &quot;task method&quot; encapsulates the low-level interactions</span>
        <span class="hljs-comment">// like entering a value into a form field or clicking on a button:</span>
        <span class="hljs-keyword">async</span> recordItemCalled(itemName) {
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._whatNeedsToBeDoneInputBox.sendKeys(itemName);
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._whatNeedsToBeDoneInputBox.sendKeys(protractor.Key.ENTER);
        }

        <span class="hljs-keyword">async</span> completeItemCalled(itemName) {
            <span class="hljs-comment">// The dynamically-generated XPath locator is now encapsulated</span>
            <span class="hljs-comment">// within the page object. But, even though it&apos;s swept under the carpet,</span>
            <span class="hljs-comment">// it&apos;s still just as complex as it was before:</span>

            <span class="hljs-keyword">await</span> element(by.xpath(
                <span class="hljs-string">`//li[*[@class=&apos;view&apos; and contains(.,&apos;<span class="hljs-subst">${ itemName }</span>&apos;)]]//input[contains(@class,&apos;toggle&apos;)]`</span>)
            ).click();
        }

        <span class="hljs-keyword">async</span> filterToShowActiveItemsOnly() {
            <span class="hljs-keyword">await</span> element(by.linkText(<span class="hljs-string">`Active`</span>))
                .click();
        },

        <span class="hljs-comment">// A data retrieval method designed to make it easier to perform</span>
        <span class="hljs-comment">// an assertion in the test</span>
        <span class="hljs-keyword">async</span> textOfRecordedItems() {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._recordedItems.getText();
        },
    };

    <span class="hljs-comment">// The test where the TodoList page object is used:</span>
    it(<span class="hljs-string">&apos;allows for the list to show active items only&apos;</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-comment">// Operations that are not part of the page object&apos;s responsibilities</span>
        <span class="hljs-comment">// are still present in the test:</span>
        <span class="hljs-keyword">await</span> protractor.browser.get(<span class="hljs-string">&apos;http://todomvc.com/examples/angularjs/#/&apos;</span>);
        <span class="hljs-keyword">await</span> protractor.browser.wait(
                protractor.ExpectedConditions.presenceOf(element(by.css(<span class="hljs-string">&apos;.new-todo&apos;</span>))),
                <span class="hljs-number">2000</span>,
            );
        expect(<span class="hljs-keyword">await</span> protractor.browser.getTitle()).toMatch(<span class="hljs-regexp">/.*TodoMVC$/</span>);

        <span class="hljs-comment">// Page objects have to be explicitly instantiated in the test</span>
        <span class="hljs-keyword">const</span> todoList = <span class="hljs-keyword">new</span> TodoList();

        <span class="hljs-comment">// Repeated calls to `recordItemCalled`</span>
        <span class="hljs-keyword">await</span> todoList.recordItemCalled(<span class="hljs-string">&apos;Play some guitar&apos;</span>);
        <span class="hljs-keyword">await</span> todoList.recordItemCalled(<span class="hljs-string">&apos;Read a book&apos;</span>);
        <span class="hljs-keyword">await</span> todoList.recordItemCalled(<span class="hljs-string">&apos;Write some code&apos;</span>);

        <span class="hljs-keyword">await</span> todoList.completeItemCalled(<span class="hljs-string">&apos;Write some code&apos;</span>);

        <span class="hljs-keyword">await</span> todoList.filterToShowActiveItemsOnly();

        <span class="hljs-comment">// Every now and then we might have to break the await/async style</span>
        <span class="hljs-comment">// and go back to chaining Promises using `.then`:</span>
        <span class="hljs-keyword">await</span> todoList.textOfRecordedItems().then(<span class="hljs-function"><span class="hljs-params">items</span> =&gt;</span> {
            expect(items).toEqual([
                <span class="hljs-string">&apos;Play some guitar&apos;</span>,
                <span class="hljs-string">&apos;Read a book&apos;</span>,
            ]);
        });
    });

    <span class="hljs-comment">// Teardown method responsible for clearing any application state</span>
    afterEach(<span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-comment">// Since the cleanup method doesn&apos;t belong to the page object</span>
        <span class="hljs-comment">// representing the TodoList, it&apos;s left in the test:</span>

        <span class="hljs-keyword">await</span> browser.executeScript(<span class="hljs-string">`window.localStorage.clear()`</span>);
    });
});
</code></pre>
<p>As you can see above, the clarity of our test has already improved:</p>
<ul>
<li>The constructor of the page objects introduces two <a href="https://refactoring.com/catalog/extractVariable.html">meaningful variables</a>
representing the elements of the <code>TodoList</code> that we&apos;d like to interact with: <code>_whatNeedsToBeDoneInputBox</code> and <code>_recordedItems</code>.
This helps to avoid duplicating the locators all over the test.</li>
<li>The low-level Protractor API calls, such as <code>element</code> or <code>element.all</code>, have been extracted and encapsulated within &quot;task methods&quot; such as <code>recordItemCalled(name)</code>,
<code>completeItemCalled(name)</code> and <code>filterToShowActiveItemsOnly()</code> available on the <code>TodoList</code> page object instance.
Those methods not only encapsulate the interaction logic but also offer a much more business-focused API.</li>
<li>Additionally, the <code>TodoList</code> page object also offers a way for us to retrieve the <code>textOfRecordedItems()</code>, which we use to perform the assertion.</li>
</ul>
<p>However, some issues are still outstanding:</p>
<ul>
<li>Since opening the web browser doesn&apos;t, strictly speaking, belong to the responsibilities of the page object, the code doing it is still left in the test.</li>
<li>Since the test requires three items to be added to the todo list, we call <code>recordItemCalled()</code> three times.
That&apos;s some duplication that could be avoided by creating some sort of a helper method.
However, adding helper methods like that to page objects can result in their API expanding quite significantly.</li>
<li>Clean up code that doesn&apos;t belong to any page object in particular, in our case code that clears the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code>localStorage</code></a>, is left in the test causing unnecessary noise and distraction.</li>
</ul>
<p>Moreover, since a Page Object works with three distinct concepts, as it:</p>
<ul>
<li>describes the elements a user can interact with,</li>
<li>the tasks they can perform on the page or using a widget,</li>
<li>as well as data retrieval methods,</li>
</ul>
<p>there are <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">three reasons</a> why its implementation might need to be changed:</p>
<ul>
<li>the page structure may have changed,</li>
<li>a test might need to describe a new user interaction with that page,</li>
<li>the data retrieval method might have changed.</li>
</ul>
<p>In all the above cases, deliberate or unintended changes to the page object carry a risk of having a negative impact on existing tests that use it. The more interactions and page elements a given page object describes, the higher the likelihood of the problem occurring.</p>
<p>Page Objects introduce another, much more subtle problem, though.</p>
<p>As the name implies, <em>Page Objects</em> reason at the level of the user interface, in terms of fields, buttons and links that the user manipulates. This affects not only the way your test is structured but also the way <em>you think</em> about the application.
Just as we shape our tools, they shape us too - instead of placing the primary focus on <strong>what</strong> the user needs to do with the application, Page Objects lead you to focus on <strong>how</strong> the user interacts with individual pages. As a result, the tests become tightly coupled to the structure of the user interface, making them more brittle and more likely to be affected by UI changes.</p>
<blockquote>
<p>Coupling the tests to the structure of the system they verify results in a test suite that&apos;s brittle and more likely to fail when the implementation of the system changes.</p>
</blockquote>
<p>Even though Page Objects reduce code duplication and encourage reuse across tests within a single project and a single test suite, the design falls short if we need to enable code reuse across multiple projects and teams. This, of course, affects the scalability and accessibility of our solution.</p>
<p>Also, the fact that each page object is tightly coupled to Protractor APIs: <code>element</code> and <code>by</code> - global functions that are browser instance-specific - makes it impossible to use this design &quot;as is&quot; for multi-browser testing (chat systems, workflow systems, multi-player games, etc.).</p>
<p>Not to mention that even after <a href="https://refactoring.com/catalog/extractClass.html">extracting</a> a Page Object from the original test script, there&apos;s still plenty of low-level Protractor/WebDriver API calls left in our test. They are necessary as they deal with managing the browser window and clearing the application state, but they also cloud the business logic of the implementation.</p>
<p>As you can see, even though Page Objects address some of the troubles with test scripts, they don&apos;t provide a complete solution.</p>
<p>Let&apos;s see if we can find the missing ingredients!</p>
<h2 id="cucumber">Cucumber</h2>
<p>At this point, you&apos;re probably wondering if adding <a href="https://github.com/cucumber/cucumber-js">Cucumber</a> into the mix could introduce the layer of abstraction our example code so desperately needs?</p>
<p>What such a move would definitely help us with is to introduce a layer of domain-specific language we could use to capture the vernacular of the business stakeholders.
Additionally, expressing acceptance test scenarios in a human-readable language, such as English, makes it easier for non-technical stakeholders to work with and review.</p>
<p>At the business level, our test scenario could be expressed as follows:</p>
<pre><code class="lang-gherkin hljs gherkin"><span class="hljs-keyword">Scenario</span>: Filter the list to show active items

  <span class="hljs-keyword">Given</span> James has a list containing: Play some guitar, Read a book, Write some code
   <span class="hljs-keyword">When</span> he completes the item called Write some code
    <span class="hljs-keyword">And</span> he filters the list to show only active items
   <span class="hljs-keyword">Then</span> he should see: Play some guitar, Read a book
</code></pre>
<p>This looks better, doesn&apos;t it?</p>
<p>Let&apos;s look at the implementation of the <a href="https://cucumber.io/docs/gherkin/step-organization/">step library</a> that powers this test, though:</p>
<pre><code class="lang-javascript hljs javascript"><span class="hljs-keyword">const</span> { Given, Then, When, Before, After } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;cucumber&apos;</span>);

Before(<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">await</span> browser.get(<span class="hljs-string">&apos;http://todomvc.com/examples/angularjs/#/&apos;</span>);
});

Given(<span class="hljs-regexp">/(.*) has a list containing: (.*)/</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">actorName, commaSeparatedItems</span>) </span>{
    <span class="hljs-keyword">const</span> todoList = <span class="hljs-keyword">new</span> TodoList();

    itemsFrom(commaSeparatedItems)
        .forEach(<span class="hljs-function"><span class="hljs-params">itemName</span> =&gt;</span> {
            <span class="hljs-keyword">await</span> todoList.recordItemCalled(itemName);
        });
});

When(<span class="hljs-regexp">/he completes the item called (.*)/</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">itemName</span>) </span>{
    <span class="hljs-keyword">await</span> todoList.completeItemCalled(itemName);
});

When(<span class="hljs-regexp">/he filters the list to show only active items/</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">itemName</span>) </span>{
    <span class="hljs-keyword">await</span> todoList.filterToShowActiveItemsOnly();
});

Then(<span class="hljs-regexp">/he should see: (.*)/</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">commaSeparatedItems</span>) </span>{
    <span class="hljs-keyword">await</span> todoList.textOfRecordedItems().then(<span class="hljs-function"><span class="hljs-params">items</span> =&gt;</span> {
                expect(items).toEqual(itemsFrom(commaSeparatedItems));
            });
});

After(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">await</span> browser.executeScript(<span class="hljs-string">`window.localStorage.clear()`</span>);
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">itemsFrom</span>(<span class="hljs-params">commaSeparatedItems</span>) </span>{
    <span class="hljs-keyword">return</span> commaSeparatedItems
               .split(<span class="hljs-string">&apos;,&apos;</span>)
               .map(<span class="hljs-function"><span class="hljs-params">itemName</span> =&gt;</span> itemName.trim());
}
</code></pre>
<p>Even with a gold standard Cucumber scenario like the one above, the Cucumber step definitions suffer from the same issues
our previous Protractor/Jasmine scenario has experienced:</p>
<ul>
<li>low-level API calls are still left in the code, and now they&apos;re accompanied by additional data transformation functions responsible for mapping the plain-English scenario to the automation code (such as <code>itemsFrom(commaSeparatedItems)</code>),</li>
<li>the low-level cleanup code is still present in the <code>After</code> hook,</li>
<li>the step definitions have to switch between the <code>async/await</code> and Promises, depending on the context of the API call,</li>
<li>and we haven&apos;t addressed any of the problems introduced with Page Objects!</li>
</ul>
<p>Not to mention, that Cucumber, while an excellent collaboration and documentation tool, doesn&apos;t address concerns around
code re-usability: you can&apos;t call a Cucumber step from within another step, for example, and <a href="https://cucumber.io/docs/guides/anti-patterns/#support-for-conjunction-steps">neither should you</a>.</p>
<h2 id="summary">Summary</h2>
<p>As you can see, even though Protractor, WebDriver and other similar tools are excellent at automating low-level interactions with the system under test, their APIs are simply too low-level to express the business intent behind those interactions. Also, using tools like that directly in our tests leads to an implementation that&apos;s full of noise, distractions, and accidental detail.</p>
<p>The Page Object(s) Pattern addresses some of the problems but falls short if what you want is a test automation system that&apos;s easy to extend, maintain and scale to multiple projects and teams.</p>
<p>While adding Cucumber into the mix could help to capture the business language and slightly improve the reports our tests produce, it doesn&apos;t by itself address the code duplication or code structure issues. I&apos;m afraid that even gold standard Cucumber scenarios can&apos;t address that because there&apos;s still something we&apos;re missing.</p>
<p>To find out what that is, we might need to change the way we think about our tests.</p>
<p>We need to start <a href="/handbook/thinking-in-serenity-js/screenplay-by-example.html">thinking in Serenity/JS</a>.</p>
</body></html>
                        </section>
                        <footer class="d-print-none">
                                <a class="previous" href="/handbook/thinking-in-serenity-js/index.html">
                                    <i class="fa fa-chevron-left"></i>
                                    <span>Thinking in Serenity/JS</span>
                                </a>
                                <a class="next" href="/handbook/thinking-in-serenity-js/screenplay-pattern.html">
                                    <span>The Screenplay Pattern</span>
                                    <i class="fa fa-chevron-right"></i>
                                </a>
                        </footer>
                    </article>
                </div>
            </div>
        </div>
    </section>

</section>

<footer id="footer" class="ftr ftr-accent-2 text-center">
    <div class="container ftr-columns d-print-none">
        <div class="row">
            <div class="col-md-2 ml-auto col-sm-4">
                <h5 class="ftr-column-title ">Get started</h5>
                <ul class="ftr-column-list">
                    <li><a href="/handbook/">Serenity/JS Handbook</a></li>
                    <li><a href="/modules/">API docs</a></li>
                    <li><a href="https://github.com/serenity-js">Project templates</a></li>
                    <li><a href="https://github.com/serenity-js/serenity-js/tree/master/examples">Examples</a></li>
                </ul>
            </div>
            <div class="col-md-2 col-sm-4">
                <h5 class="ftr-column-title ">Support</h5>
                <ul class="ftr-column-list">
                    <li><a href="/support.html">Free Support</a></li>
                    <li><a href="/support.html#corporate-sponsorship-and-support">Commercial Support</a></li>
                    <li><a href="/support.html#serenity-js-mentoring">Mentoring</a></li>
                    <li><a href="/support.html#serenity-js-training">Training</a></li>
                    <li><a href="/community/sponsors.html">Serenity/JS Sponsors</a></li>
                    <li><a href="https://gitter.im/serenity-js/Lobby">Chat on Gitter</a></li>
                </ul>
            </div>
            <div class="col-md-2 mr-auto col-sm-4">
                <h5 class="ftr-column-title">Developers</h5>
                <ul class="ftr-column-list">
                    <li><a href="https://github.com/serenity-js">Serenity/JS on Github</a></li>
                    <li><a href="/handbook/integration">Integration guide</a></li>
                    <li><a href="/changelog.html">Changelog</a></li>
                    <li><a href="/contributing.html">Contributing</a></li>
                    <li><a href="/license.html">License</a></li>
                </ul>
            </div>
        </div>
        <div class="col-lg-6 mx-auto">
            <div class="ftr-column-list">
                <a class="github-button" href="https://github.com/sponsors/jan-molak" data-icon="octicon-heart" data-size="large" aria-label="Sponsor @jan-molak on GitHub">Sponsor</a>
                <a class="github-button" href="https://github.com/serenity-js/serenity-js" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star jan-molak/serenity-js on GitHub">Star</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-6 mx-auto ftr-bt ftr-oneline ">
                Made with love in London, UK &copy; 2016 - 2020 <a href="https://janmolak.com" target="_blank">Jan Molak</a>, smartcode ltd.
            </div>
        </div>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
        integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"
        integrity="sha256-m1eTvwEHwmsw4+XKF7BshClVJEPwTVycveNl0CS0Mkk="
        crossorigin="anonymous"></script>
<!-- Place this tag in your head or just before your close body tag. -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<script src="/js/charming-pro.js"></script>

<script src="/js/search_index_initialiser.js"></script>
<script src="/js/inherited-summary.js"></script>
<script src="/js/test-summary.js"></script>
<script src="/js/patch-for-local.js"></script>

<script>
    anchors.add('article h1, article h2, article h3, article h4');
</script>

<script type="text/javascript" id="cookieinfo"
        src="//cookieinfoscript.com/js/cookieinfo.min.js"
        data-message="We use analytical cookies to optimise the performance of this website. By continuing to use this site you agree to help us make it better for everyone."
        data-close-text="Got it!"
>
</script>
</body>
</html>
